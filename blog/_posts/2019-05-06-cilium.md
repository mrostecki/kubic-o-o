---
layout: post
title:  "Using Cilium as a network plugin"
date:   2019-05-06 00:00:00 +0200
author: Michal Rostecki
---

Most of the time, the only network plugin described by Kubic documentation and
packaged in openSUSE was [flannel](https://github.com/coreos/flannel). It's a
widely used and lightweight plugin, although it does not have some features
which are expected nowadays from network plugins. One of examples are
[network policies](https://kubernetes.io/docs/concepts/services-networking/network-policies/).

But now it's changing and we started to provide more advanced networking through
official openSUSE packaging, container images and manifests which allow to set
up [Cilium](https://cilium.io/) on Kubic clusters. The main
[kubeadm guide](https://en.opensuse.org/Kubic:kubeadm) is updated with
instuctions including Cilium as an alternative.

### What does it mean?

Cilium comes with the following features which flannel does not provide:

- It allows to use [network policies](https://kubernetes.io/docs/concepts/services-networking/network-policies/).
- Prometheus metrics.

### What exactly is Cilium?

Cilium is an open source project which provides networking and security policies
for containers which uses the Linux kernel technology called BPF (which I'm
going to describe in details later). It operates on Layer 3 and 4 to implement
networking datapath, but also operated on Layer 7 to filter.

### What is BPF?

Berkeley Packet Filter (BPF)

In Linux kernel, we de facto have two implementations of BPF:

- classic BPF (cBPF)
- extended BPF (eBPF)

eBPF is the implementation which is actively developed and used by Cilium. In
fact, if someone says "BPF", the most of people assume eBPF.

There are several limitations for BPF programs:

- 

### What about DPDK?


### How to set it up?

Cilium container images are available in [openSUSE registry](https://registry.opensuse.org/)
and manifest based on them is published on [Github](https://github.com/kubic-project/k8s-manifests).

To deploy Cilium on Kubernetes cluster, use the following command:

```
kubectl apply -f https://raw.githubusercontent.com/kubic-project/k8s-manifests/master/cilium.yaml
```
